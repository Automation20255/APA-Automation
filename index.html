<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visionary CitePro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Lora:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; color: #0f172a; }
        .glass-sidebar { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-bottom: 1px solid #e2e8f0; }
        @media (min-width: 1024px) {
            .glass-sidebar { border-bottom: none; border-right: 1px solid #e2e8f0; }
        }
        .input-field { background: #ffffff; border: 1px solid #cbd5e1; transition: all 0.2s; font-size: 16px !important; } /* Prevents iOS zoom on focus */
        .input-field:focus { border-color: #4f46e5; box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1); outline: none; }
        .citation-card { font-family: 'Lora', serif; line-height: 1.8; }
        @media (min-width: 640px) {
            .citation-card { padding-left: 2.5rem; text-indent: -2.5rem; }
        }
        .btn-primary { background: #1e293b; transition: all 0.3s; }
        .btn-primary:active { transform: scale(0.98); }
        .label-style { font-size: 11px; font-weight: 700; color: #64748b; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 6px; display: block; }
    </style>
</head>
<body class="antialiased">

    <div class="flex flex-col lg:flex-row min-h-screen">
        <aside class="glass-sidebar w-full lg:w-[450px] p-6 md:p-8 flex flex-col shrink-0 lg:sticky lg:top-0 lg:h-screen overflow-y-auto">
            <div class="mb-8">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-indigo-200">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
                    </div>
                    <h1 class="text-xl md:text-2xl font-800 tracking-tight">Visionary CitePro <span class="text-indigo-600">v1.9</span></h1>
                </div>
                <div class="bg-slate-100 px-4 py-2 rounded-xl border border-slate-200 inline-block">
                    <p class="text-[10px] font-bold text-slate-500 uppercase tracking-widest leading-none mb-1">Author</p>
                    <p class="text-xs font-extrabold text-slate-900">Dr. Dhaval Patel</p>
                </div>
            </div>

            <div class="space-y-5">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label class="label-style">Select Style</label>
                        <select id="style" class="input-field w-full p-3 rounded-xl text-sm font-semibold cursor-pointer">
                            <option value="APA">APA 7th Edition</option>
                            <option value="MLA">MLA 9th Edition</option>
                            <option value="Chicago">Chicago (Author-Date)</option>
                            <option value="Harvard">Harvard Style</option>
                        </select>
                    </div>
                    <div>
                        <label class="label-style">Source Category</label>
                        <select id="type" onchange="renderFields()" class="input-field w-full p-3 rounded-xl text-sm font-semibold cursor-pointer">
                            <option value="journal">Journal Article</option>
                            <option value="book">Book (Whole)</option>
                            <option value="chapter">Book Chapter</option>
                            <option value="website">Website</option>
                        </select>
                    </div>
                </div>

                <div class="space-y-4 pt-4 border-t border-slate-100">
                    <div>
                        <label class="label-style">Author(s)</label>
                        <input type="text" id="author" placeholder="e.g. Dhaval A Patel; Jane Smith" class="input-field w-full p-3.5 rounded-xl text-sm">
                        <p class="text-[10px] text-slate-400 mt-1 italic">Separate authors with a semicolon (;)</p>
                    </div>

                    <div>
                        <label class="label-style">Title of Work</label>
                        <input type="text" id="title" placeholder="e.g. Modern Web Development" class="input-field w-full p-3.5 rounded-xl text-sm">
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                        <div class="sm:col-span-1">
                            <label class="label-style">Pub. Year</label>
                            <input type="text" id="year" placeholder="2025" class="input-field w-full p-3.5 rounded-xl text-sm text-center">
                        </div>
                        <div id="dynamicContainer" class="sm:col-span-2 grid grid-cols-2 gap-3">
                            </div>
                    </div>
                </div>

                <button onclick="addEntry()" id="mainBtn" class="btn-primary w-full text-white font-bold py-4 rounded-2xl shadow-xl flex items-center justify-center gap-2 mt-4 hover:bg-indigo-600">
                    <span id="btnLabel">Generate Citation</span>
                </button>
            </div>
        </aside>

        <main class="flex-grow p-6 md:p-10 lg:p-16">
            <div class="max-w-4xl mx-auto">
                <header class="flex flex-col sm:flex-row sm:items-end justify-between mb-8 border-b border-slate-200 pb-8 gap-6">
                    <div>
                        <h2 class="text-3xl md:text-4xl font-900 text-slate-900 tracking-tight">Bibliography</h2>
                        <p class="text-slate-500 font-medium mt-1 text-sm">Academic Suite by Dr. Dhaval Patel</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="copyAll()" class="flex-1 sm:flex-none px-5 py-3 bg-white border border-slate-200 rounded-xl text-[10px] font-bold uppercase tracking-wider hover:bg-slate-50 shadow-sm">Copy All</button>
                        <button onclick="clearList()" class="flex-1 sm:flex-none px-5 py-3 bg-red-50 text-red-600 rounded-xl text-[10px] font-bold uppercase tracking-wider hover:bg-red-100">Clear</button>
                    </div>
                </header>

                <div id="bibList" class="space-y-6 md:space-y-8">
                    </div>
            </div>
        </main>
    </div>

    <script>
        let bibData = JSON.parse(localStorage.getItem('cite_pro_v35')) || [];
        let editId = null;

        function renderFields() {
            const type = document.getElementById('type').value;
            const container = document.getElementById('dynamicContainer');
            container.innerHTML = '';

            const inputs = {
                journal: [
                    {id: 'f1', label: 'Journal Name', col: 'col-span-2'},
                    {id: 'f2', label: 'Vol', col: 'col-span-1'},
                    {id: 'f3', label: 'Issue', col: 'col-span-1'},
                    {id: 'f4', label: 'Page No.', col: 'col-span-2'}
                ],
                book: [
                    {id: 'f1', label: 'Publisher', col: 'col-span-2'},
                    {id: 'f2', label: 'Edition', col: 'col-span-2'}
                ],
                chapter: [
                    {id: 'f1', label: 'Book Title', col: 'col-span-2'},
                    {id: 'f2', label: 'Editor', col: 'col-span-2'},
                    {id: 'f3', label: 'Page No.', col: 'col-span-2'}
                ],
                website: [
                    {id: 'f1', label: 'Website Name', col: 'col-span-2'},
                    {id: 'f2', label: 'URL Link', col: 'col-span-2'}
                ]
            };

            inputs[type].forEach(field => {
                container.innerHTML += `
                    <div class="${field.col}">
                        <label class="label-style">${field.label}</label>
                        <input type="text" id="${field.id}" placeholder="${field.label}" class="input-field w-full p-3 rounded-xl text-xs">
                    </div>`;
            });
        }

        // Logic functions (formatAuthor, generateCitation, addEntry, editEntry, etc.) 
        // copied from your original script to ensure functionality remains intact.
        
        function formatAuthor(input, style) {
            if (!input) return "Anonymous";
            const authors = input.split(';').map(a => a.trim());
            const parse = (name) => {
                let pts = name.split(/\s+/);
                if (pts.length === 1) return name;
                let last = pts.pop();
                let first = pts[0];
                let initials = first[0] + '.';
                if (pts.length > 1) initials += ' ' + pts[1][0] + '.';
                if (style === 'APA' || style === 'Harvard') return `${last}, ${initials}`;
                return `${last}, ${pts.join(' ')}`;
            };
            if (authors.length === 1) return parse(authors[0]);
            if (authors.length === 2) return `${parse(authors[0])} & ${parse(authors[1])}`;
            return `${parse(authors[0])}, et al.`;
        }

        function generateCitation() {
            const style = document.getElementById('style').value;
            const type = document.getElementById('type').value;
            const author = formatAuthor(document.getElementById('author').value, style);
            const title = document.getElementById('title').value;
            const year = document.getElementById('year').value || '2025';
            const f1 = document.getElementById('f1')?.value || '';
            const f2 = document.getElementById('f2')?.value || '';
            const f3 = document.getElementById('f3')?.value || '';
            const f4 = document.getElementById('f4')?.value || '';

            if (style === 'APA') {
                if (type === 'journal') return `${author} (${year}). ${title}. <i>${f1}</i>, <i>${f2}</i>(${f3}), ${f4}.`;
                if (type === 'book') return `${author} (${year}). <i>${title}</i> (${f2 || '1st'} ed.). ${f1}.`;
                if (type === 'chapter') return `${author} (${year}). ${title}. In ${f2} (Ed.), <i>${f1}</i> (pp. ${f3}).`;
                return `${author} (${year}). <i>${title}</i>. ${f1}. ${f2}`;
            } 
            if (style === 'MLA') {
                if (type === 'journal') return `${author}. "${title}." <i>${f1}</i>, vol. ${f2}, no. ${f3}, ${year}, pp. ${f4}.`;
                if (type === 'book') return `${author}. <i>${title}</i>. ${f2 ? f2 + ' ed.,' : ''} ${f1}, ${year}.`;
                return `${author}. "${title}." <i>${f1}</i>, ${year}, ${f2}.`;
            }
            return `${author} (${year}) '${title}', <i>${f1}</i>, ${f2}${f3 ? '('+f3+')' : ''}, pp. ${f4}.`;
        }

        function addEntry() {
            if(!document.getElementById('author').value || !document.getElementById('title').value) return alert("Enter Author & Title");
            const entry = {
                id: editId || Date.now(),
                formatted: generateCitation(),
                raw: {
                    author: document.getElementById('author').value,
                    title: document.getElementById('title').value,
                    year: document.getElementById('year').value,
                    type: document.getElementById('type').value,
                    style: document.getElementById('style').value,
                    f1: document.getElementById('f1')?.value,
                    f2: document.getElementById('f2')?.value,
                    f3: document.getElementById('f3')?.value,
                    f4: document.getElementById('f4')?.value
                }
            };
            if(editId) {
                bibData = bibData.map(e => e.id === editId ? entry : e);
                editId = null;
                document.getElementById('btnLabel').innerText = "Generate Citation";
            } else {
                bibData.push(entry);
            }
            localStorage.setItem('cite_pro_v35', JSON.stringify(bibData));
            renderList();
            reset();
            // Scroll to bottom on mobile to see the new entry
            if(window.innerWidth < 1024) {
                window.scrollTo({top: document.body.scrollHeight, behavior: 'smooth'});
            }
        }

        function renderList() {
            const list = document.getElementById('bibList');
            if(bibData.length === 0) {
                list.innerHTML = `<div class="py-16 text-center border-2 border-dashed border-slate-200 rounded-3xl text-slate-400 text-sm">Bibliography is empty.</div>`;
                return;
            }
            bibData.sort((a,b) => a.formatted.localeCompare(b.formatted));
            list.innerHTML = bibData.map(e => `
                <div class="group bg-white p-6 md:p-8 rounded-2xl border border-slate-100 hover:border-indigo-200 transition-all">
                    <div class="citation-card text-slate-800 text-base md:text-lg">${e.formatted}</div>
                    <div class="mt-6 pt-4 border-t border-slate-50 flex flex-wrap gap-4 opacity-100 lg:opacity-0 lg:group-hover:opacity-100 transition-all">
                        <button onclick="copySingle('${e.id}')" class="text-[10px] font-black uppercase tracking-widest text-indigo-600">Copy</button>
                        <button onclick="editEntry(${e.id})" class="text-[10px] font-black uppercase tracking-widest text-slate-400">Edit</button>
                        <button onclick="deleteEntry(${e.id})" class="text-[10px] font-black uppercase tracking-widest text-red-400">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function editEntry(id) {
            const e = bibData.find(x => x.id === id);
            editId = id;
            document.getElementById('author').value = e.raw.author;
            document.getElementById('title').value = e.raw.title;
            document.getElementById('year').value = e.raw.year;
            document.getElementById('type').value = e.raw.type;
            document.getElementById('style').value = e.raw.style;
            renderFields();
            if(document.getElementById('f1')) document.getElementById('f1').value = e.raw.f1;
            if(document.getElementById('f2')) document.getElementById('f2').value = e.raw.f2;
            if(document.getElementById('f3')) document.getElementById('f3').value = e.raw.f3;
            if(document.getElementById('f4')) document.getElementById('f4').value = e.raw.f4;
            document.getElementById('btnLabel').innerText = "Update Entry";
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        function deleteEntry(id) {
            if(confirm("Delete this citation?")) {
                bibData = bibData.filter(x => x.id !== id);
                localStorage.setItem('cite_pro_v35', JSON.stringify(bibData));
                renderList();
            }
        }

        function reset() {
            document.getElementById('author').value = '';
            document.getElementById('title').value = '';
            document.getElementById('year').value = '';
            renderFields();
        }

        function copySingle(id) {
            const e = bibData.find(x => x.id == id);
            const div = document.createElement('div');
            div.innerHTML = e.formatted;
            navigator.clipboard.writeText(div.innerText);
            alert("Copied to clipboard!");
        }

        function copyAll() {
            const txt = bibData.map(e => {
                const d = document.createElement('div');
                d.innerHTML = e.formatted;
                return d.innerText;
            }).join('\n\n');
            navigator.clipboard.writeText(txt);
            alert("All citations copied!");
        }

        function clearList() { if(confirm("Clear everything?")) { bibData = []; localStorage.clear(); renderList(); } }

        renderFields();
        renderList();
    </script>
</body>
</html>
